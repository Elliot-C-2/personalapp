<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>GRIND</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;900&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
:root{
  --bg:#0e0f11;
  --bg2:#161719;
  --bg3:#1e2023;
  --border:#2a2d32;
  --accent:#c8f04a;
  --accent-dim:rgba(200,240,74,0.12);
  --accent-glow:rgba(200,240,74,0.25);
  --red:#ff5c5c;
  --red-dim:rgba(255,92,92,0.12);
  --text:#e8eaed;
  --text-dim:#6b7280;
  --text-mid:#9ca3af;
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bot:env(safe-area-inset-bottom,0px);
}
html,body{width:100%;min-height:100%;background:var(--bg);color:var(--text);font-family:'Barlow',sans-serif;overflow-x:hidden;}
body{padding-bottom:calc(72px + var(--safe-bot));}

/* NAV */
.nav{position:fixed;bottom:0;left:0;right:0;z-index:100;background:var(--bg2);border-top:1px solid var(--border);display:flex;padding-bottom:var(--safe-bot);}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 0 8px;gap:3px;background:none;border:none;cursor:pointer;font-family:'Barlow',sans-serif;font-size:10px;letter-spacing:0.06em;color:var(--text-dim);text-transform:uppercase;transition:color 0.15s;}
.nav-btn svg{width:20px;height:20px;stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;}
.nav-btn.active{color:var(--accent);}

/* PAGES */
.page{display:none;padding:0 16px;padding-top:calc(var(--safe-top) + 60px);}
.page.active{display:block;}

/* HEADER */
.page-header{position:fixed;top:0;left:0;right:0;z-index:50;background:var(--bg);padding:calc(var(--safe-top) + 12px) 16px 12px;border-bottom:1px solid var(--border);}
.page-title{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;letter-spacing:0.05em;text-transform:uppercase;}
.page-sub{font-size:12px;color:var(--text-dim);margin-top:1px;}

/* CARDS */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px;}
.card-label{font-family:'Barlow Condensed',sans-serif;font-size:11px;font-weight:600;letter-spacing:0.18em;text-transform:uppercase;color:var(--text-dim);margin-bottom:8px;}

/* HOME */
.streak-row{display:flex;gap:10px;margin-bottom:12px;}
.streak-box{flex:1;background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:2px;}
.streak-num{font-family:'Barlow Condensed',sans-serif;font-size:36px;font-weight:900;color:var(--accent);line-height:1;}
.streak-lbl{font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.1em;}
.week-dots{display:flex;gap:6px;margin-top:8px;}
.week-dot{flex:1;height:6px;border-radius:99px;background:var(--border);transition:background 0.3s;}
.week-dot.done{background:var(--accent);}
.week-dot.today{background:var(--accent);opacity:0.5;}

.today-card{background:var(--bg2);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:12px;}
.today-header{background:var(--accent);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;}
.today-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:900;color:#0e0f11;text-transform:uppercase;letter-spacing:0.05em;}
.today-meta{font-size:12px;color:rgba(14,15,17,0.6);font-weight:500;}
.today-body{padding:12px 16px;}
.exercise-preview{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);}
.exercise-preview:last-child{border:none;}
.ex-name{font-size:14px;color:var(--text);}
.ex-reps{font-family:'Barlow Condensed',sans-serif;font-size:14px;font-weight:600;color:var(--text-mid);}

.start-btn{width:100%;padding:16px;border-radius:12px;border:none;background:var(--accent);color:#0e0f11;font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:900;letter-spacing:0.1em;text-transform:uppercase;cursor:pointer;transition:transform 0.1s;margin-bottom:12px;}
.start-btn:active{transform:scale(0.98);}

.rest-card{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:32px 16px;text-align:center;margin-bottom:12px;}
.rest-emoji{font-size:48px;margin-bottom:12px;}
.rest-title{font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:900;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px;}
.rest-sub{font-size:14px;color:var(--text-dim);line-height:1.6;}

.completed-card{background:var(--accent-dim);border:1px solid var(--accent-glow);border-radius:16px;padding:24px 16px;text-align:center;margin-bottom:12px;}
.completed-title{font-family:'Barlow Condensed',sans-serif;font-size:24px;font-weight:900;color:var(--accent);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px;}
.completed-sub{font-size:13px;color:var(--text-dim);}

/* WORKOUT */
.workout-header-info{background:var(--bg2);border-radius:12px;padding:14px 16px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between;}
.wh-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:900;text-transform:uppercase;letter-spacing:0.05em;}
.wh-sub{font-size:12px;color:var(--text-dim);margin-top:1px;}
.wh-right{text-align:right;}
.wh-progress{font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:900;color:var(--accent);}
.wh-done{font-size:11px;color:var(--text-dim);}

.ex-card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:14px;cursor:pointer;transition:border-color 0.2s,background 0.2s;-webkit-user-select:none;user-select:none;}
.ex-card.done{background:var(--accent-dim);border-color:var(--accent-glow);}
.ex-card.preview{cursor:default;}
.ex-check{width:28px;height:28px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.2s;}
.ex-card.done .ex-check{background:var(--accent);border-color:var(--accent);}
.ex-check svg{width:14px;height:14px;stroke:#0e0f11;fill:none;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round;opacity:0;transition:opacity 0.15s;}
.ex-card.done .ex-check svg{opacity:1;}
.ex-info{flex:1;}
.ex-title{font-size:15px;font-weight:500;transition:color 0.2s;}
.ex-card.done .ex-title{color:var(--text-dim);}
.ex-detail{font-size:12px;color:var(--text-dim);margin-top:2px;}
.ex-badge{font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:700;color:var(--accent);letter-spacing:0.05em;white-space:nowrap;}
.ex-card.done .ex-badge{color:var(--text-dim);}

.section-label{font-family:'Barlow Condensed',sans-serif;font-size:11px;font-weight:600;letter-spacing:0.2em;text-transform:uppercase;color:var(--text-dim);margin:16px 0 8px;padding-left:4px;}

.finish-btn{width:100%;padding:18px;border-radius:12px;border:none;background:var(--border);color:var(--text-dim);font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:900;letter-spacing:0.1em;text-transform:uppercase;cursor:not-allowed;transition:all 0.3s;margin-top:8px;margin-bottom:8px;}
.finish-btn.ready{background:var(--accent);color:#0e0f11;cursor:pointer;}
.finish-btn.ready:active{transform:scale(0.98);}

.preview-banner{background:var(--accent-dim);border:1px solid var(--accent-glow);border-radius:10px;padding:10px 14px;margin-bottom:12px;font-size:12px;color:var(--accent);letter-spacing:0.05em;}

.ghost-btn{width:100%;padding:14px;border-radius:12px;border:1px solid var(--border);background:var(--bg2);color:var(--text-dim);font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;cursor:pointer;transition:all 0.2s;margin-bottom:10px;}
.ghost-btn:active{border-color:var(--text-dim);}

/* HISTORY */
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:12px;}
.cal-day-name{font-size:10px;text-align:center;color:var(--text-dim);padding:4px 0;font-weight:500;text-transform:uppercase;letter-spacing:0.05em;}
.cal-day{aspect-ratio:1;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:500;color:var(--text-dim);}
.cal-day.workout-done{background:var(--accent);color:#0e0f11;font-weight:700;}
.cal-day.workout-missed{background:var(--red-dim);color:var(--red);}
.cal-day.rest-day{background:var(--bg3);}
.cal-day.today{outline:2px solid var(--accent);outline-offset:1px;color:var(--text);}
.cal-day.future{opacity:0.25;}
.cal-day.empty{background:transparent;}
.legend-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:4px;}
.legend-item{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-dim);}
.legend-dot{width:10px;height:10px;border-radius:3px;}
.history-item{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);}
.history-item:last-child{border:none;}
.hi-date{font-size:13px;font-weight:500;}
.hi-type{font-size:12px;color:var(--text-dim);margin-top:1px;}
.hi-badge{font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:700;padding:4px 10px;border-radius:99px;}
.hi-badge.done{background:var(--accent-dim);color:var(--accent);}
.hi-badge.missed{background:var(--red-dim);color:var(--red);}

/* SETTINGS */
.setting-row{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid var(--border);}
.setting-row:last-child{border:none;}
.setting-label{font-size:14px;}
.setting-sub{font-size:12px;color:var(--text-dim);margin-top:2px;}
.setting-input{background:var(--bg3);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Barlow',sans-serif;font-size:14px;padding:8px 12px;outline:none;width:140px;text-align:right;}
.setting-input:focus{border-color:var(--accent);}
input[type="date"].setting-input{color-scheme:dark;}
.danger-btn{background:var(--red-dim);border:1px solid var(--red);color:var(--red);padding:8px 14px;border-radius:8px;font-family:'Barlow',sans-serif;font-size:13px;cursor:pointer;}

/* CELEBRATION */
.celebration{position:fixed;inset:0;z-index:200;background:rgba(14,15,17,0.93);display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s;padding:24px;text-align:center;}
.celebration.show{opacity:1;pointer-events:all;}
.cel-emoji{font-size:72px;margin-bottom:16px;animation:bounce 0.6s ease infinite alternate;}
@keyframes bounce{from{transform:translateY(0);}to{transform:translateY(-12px);}}
.cel-title{font-family:'Barlow Condensed',sans-serif;font-size:42px;font-weight:900;color:var(--accent);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px;}
.cel-sub{font-size:16px;color:var(--text-dim);margin-bottom:32px;line-height:1.6;}
.cel-btn{padding:16px 40px;border-radius:12px;border:none;background:var(--accent);color:#0e0f11;font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:900;letter-spacing:0.1em;text-transform:uppercase;cursor:pointer;}
</style>
</head>
<body>

<!-- HOME -->
<div class="page active" id="page-home">
  <div class="page-header">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div class="page-title">GRIND</div>
        <div class="page-sub" id="home-date"></div>
      </div>
      <div style="font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:700;color:var(--text-dim);letter-spacing:0.1em;" id="week-badge"></div>
    </div>
  </div>
  <div id="home-content"></div>
</div>

<!-- WORKOUT -->
<div class="page" id="page-workout">
  <div class="page-header">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div class="page-title" id="workout-page-title">Today's Workout</div>
      <button onclick="showPage('home')" style="background:none;border:none;color:var(--text-dim);font-family:'Barlow',sans-serif;font-size:13px;cursor:pointer;">Back</button>
    </div>
  </div>
  <div id="workout-content"></div>
</div>

<!-- HISTORY -->
<div class="page" id="page-history">
  <div class="page-header">
    <div class="page-title">History</div>
    <div class="page-sub" id="history-sub"></div>
  </div>
  <div id="history-content"></div>
</div>

<!-- SETTINGS -->
<div class="page" id="page-settings">
  <div class="page-header">
    <div class="page-title">Settings</div>
  </div>
  <div id="settings-content"></div>
</div>

<!-- NAV -->
<nav class="nav">
  <button class="nav-btn active" id="nav-home" onclick="showPage('home')">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    Home
  </button>
  <button class="nav-btn" id="nav-workout" onclick="showPage('workout')">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
    Workout
  </button>
  <button class="nav-btn" id="nav-history" onclick="showPage('history')">
    <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    History
  </button>
  <button class="nav-btn" id="nav-settings" onclick="showPage('settings')">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    Settings
  </button>
</nav>

<!-- CELEBRATION -->
<div class="celebration" id="celebration">
  <div class="cel-emoji">&#x1F4AA;</div>
  <div class="cel-title" id="cel-title">Session Done!</div>
  <div class="cel-sub" id="cel-sub"></div>
  <button class="cel-btn" onclick="dismissCelebration()">Let's Go</button>
</div>

<script>
// ══════════════════════════════════════
// PROGRAM DATA
// ══════════════════════════════════════
const PROGRAM = [
  { weeks:[1,2], sets:2,
    dayA:[
      {name:'Pushups',                reps:'5 reps',       section:'Push',             tip:'Keep core tight, chest to floor'},
      {name:'Dumbbell Shoulder Press',reps:'8 reps',       section:'Push',             tip:'5kg each hand, press straight up'},
      {name:'Lateral Raises',         reps:'8 reps',       section:'Push',             tip:'5kg, raise to shoulder height, slow'},
      {name:'Plank',                  reps:'20 sec',       section:'Core',             tip:'Forearms down, flat back, breathe'},
      {name:'Dead Bugs',              reps:'6 reps/side',  section:'Core',             tip:'Lower back pressed to floor the whole time'},
      {name:'Chin Tucks',             reps:'8 reps',       section:'Neck & Shoulders', tip:'Pull chin straight back, hold 3s'},
      {name:'Scapular Squeezes',      reps:'8 reps',       section:'Neck & Shoulders', tip:'Squeeze shoulder blades together, hold 3s'},
    ],
    dayB:[
      {name:'Table Rows',             reps:'6 reps',       section:'Pull',             tip:'Under sturdy table, pull chest up to edge'},
      {name:'Towel Face Pulls',       reps:'8 reps',       section:'Pull',             tip:'Towel on door handle, pull to forehead, elbows high'},
      {name:'Bodyweight Squats',      reps:'10 reps',      section:'Legs',             tip:'Feet shoulder-width, knees track over toes'},
      {name:'Glute Bridges',          reps:'10 reps',      section:'Legs',             tip:'Squeeze glutes at top, hold 1s'},
      {name:'Romanian Deadlifts',     reps:'8 reps',       section:'Legs',             tip:'5kg each hand, hinge at hips, feel hamstrings'},
      {name:'Bird Dogs',              reps:'6 reps/side',  section:'Core',             tip:'On all fours, extend opposite arm and leg, hold 2s'},
      {name:'Scapular Squeezes',      reps:'8 reps',       section:'Neck & Shoulders', tip:'Squeeze shoulder blades together, hold 3s'},
    ]
  },
  { weeks:[3,4], sets:3,
    dayA:[
      {name:'Pushups',                reps:'10 reps',      section:'Push',             tip:'Control the descent, 2 seconds down'},
      {name:'Dumbbell Shoulder Press',reps:'10 reps',      section:'Push',             tip:'5kg each hand, full range of motion'},
      {name:'Lateral Raises',         reps:'10 reps',      section:'Push',             tip:'Slow and controlled, no swinging'},
      {name:'Plank',                  reps:'30 sec',       section:'Core',             tip:'Squeeze everything, don\'t let hips drop'},
      {name:'Dead Bugs',              reps:'8 reps/side',  section:'Core',             tip:'Slow and controlled, no arching'},
      {name:'Chin Tucks',             reps:'10 reps',      section:'Neck & Shoulders', tip:'Hold 3s each rep, feel the stretch'},
      {name:'Scapular Squeezes',      reps:'10 reps',      section:'Neck & Shoulders', tip:'Think pinching a pencil between your shoulder blades'},
    ],
    dayB:[
      {name:'Table Rows',             reps:'10 reps',      section:'Pull',             tip:'Pause at top, squeeze back'},
      {name:'Towel Face Pulls',       reps:'10 reps',      section:'Pull',             tip:'Pull to nose level, squeeze shoulder blades'},
      {name:'Bodyweight Squats',      reps:'15 reps',      section:'Legs',             tip:'Go below parallel if comfortable'},
      {name:'Glute Bridges',          reps:'15 reps',      section:'Legs',             tip:'Drive hips as high as possible'},
      {name:'Romanian Deadlifts',     reps:'10 reps',      section:'Legs',             tip:'Slow on the way down, feel the stretch'},
      {name:'Bird Dogs',              reps:'8 reps/side',  section:'Core',             tip:'Hold 3s, don\'t let hips rotate'},
      {name:'Scapular Squeezes',      reps:'10 reps',      section:'Neck & Shoulders', tip:'Hold 3s each rep'},
    ]
  },
  { weeks:[5,6], sets:3,
    dayA:[
      {name:'Pushups',                reps:'15 reps',      section:'Push',             tip:'3 second descent, full range'},
      {name:'Dumbbell Shoulder Press',reps:'12 reps',      section:'Push',             tip:'Full lockout at top, controlled down'},
      {name:'Lateral Raises',         reps:'12 reps',      section:'Push',             tip:'No swinging, pure shoulder'},
      {name:'Plank',                  reps:'45 sec',       section:'Core',             tip:'Every second counts, don\'t give up'},
      {name:'Dead Bugs',              reps:'10 reps/side', section:'Core',             tip:'Breathe out as you extend, back stays flat'},
      {name:'Chin Tucks',             reps:'12 reps',      section:'Neck & Shoulders', tip:'Add a gentle nod at the end of each rep'},
      {name:'Scapular Squeezes',      reps:'12 reps',      section:'Neck & Shoulders', tip:'Hold 4s, get a deep squeeze'},
    ],
    dayB:[
      {name:'Table Rows',             reps:'14 reps',      section:'Pull',             tip:'Slow 3s down, explosive pull up'},
      {name:'Towel Face Pulls',       reps:'12 reps',      section:'Pull',             tip:'External rotation at peak, hold 2s'},
      {name:'Bodyweight Squats',      reps:'20 reps',      section:'Legs',             tip:'Tempo: 3s down, 1s pause, up'},
      {name:'Glute Bridges',          reps:'20 reps',      section:'Legs',             tip:'Pause 2s at the top'},
      {name:'Romanian Deadlifts',     reps:'12 reps',      section:'Legs',             tip:'Feel the hamstring stretch, controlled'},
      {name:'Bird Dogs',              reps:'10 reps/side', section:'Core',             tip:'Hold 3s, super slow, no rotation'},
      {name:'Scapular Squeezes',      reps:'12 reps',      section:'Neck & Shoulders', tip:'Hold 4s, really squeeze'},
    ]
  },
  { weeks:[7], sets:3,
    dayA:[
      {name:'Pushups',                reps:'20 reps',      section:'Push',             tip:'Full range, perfect form — you\'ve earned this'},
      {name:'Dumbbell Shoulder Press',reps:'15 reps',      section:'Push',             tip:'Last week of break, give it everything'},
      {name:'Lateral Raises',         reps:'15 reps',      section:'Push',             tip:'Slow, controlled, feel every rep'},
      {name:'Plank',                  reps:'60 sec',       section:'Core',             tip:'One minute. You got this.'},
      {name:'Dead Bugs',              reps:'12 reps/side', section:'Core',             tip:'Perfect form, no shortcuts now'},
      {name:'Chin Tucks',             reps:'15 reps',      section:'Neck & Shoulders', tip:'Your neck will thank you in 20 years'},
      {name:'Scapular Squeezes',      reps:'15 reps',      section:'Neck & Shoulders', tip:'Hold 5s, deep squeeze'},
    ],
    dayB:[
      {name:'Table Rows',             reps:'18 reps',      section:'Pull',             tip:'Hardest set of the program. Go.'},
      {name:'Towel Face Pulls',       reps:'15 reps',      section:'Pull',             tip:'Peak week, perfect execution'},
      {name:'Bodyweight Squats',      reps:'25 reps',      section:'Legs',             tip:'Slow tempo, deep squat'},
      {name:'Glute Bridges',          reps:'25 reps',      section:'Legs',             tip:'3s hold at the top every rep'},
      {name:'Romanian Deadlifts',     reps:'15 reps',      section:'Legs',             tip:'Max stretch, controlled all the way'},
      {name:'Bird Dogs',              reps:'12 reps/side', section:'Core',             tip:'Hold 4s, peak week precision'},
      {name:'Scapular Squeezes',      reps:'15 reps',      section:'Neck & Shoulders', tip:'Hold 5s, finish strong'},
    ]
  },
];

const DAYS     = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const MONTHS   = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const MONTHS_S = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

// ══════════════════════════════════════
// STATE  (only { done: true } saved on finish — no partial saves)
// ══════════════════════════════════════
const STORE_KEY = 'grind_v2';
function loadState() {
  try { const d = localStorage.getItem(STORE_KEY); return d ? JSON.parse(d) : null; } catch(e) { return null; }
}
function saveState() { localStorage.setItem(STORE_KEY, JSON.stringify(state)); }

let state = loadState() || { startDate:'2026-03-01', workouts:{} };

// ══════════════════════════════════════
// SCHEDULE  (Mon / Wed / Fri, 7 weeks)
// ══════════════════════════════════════
let schedule = {};
function buildSchedule() {
  schedule = {};
  const start = parseDate(state.startDate);
  let n = 0;
  for (let i = 0; i < 7*7+14; i++) {
    const d = new Date(start);
    d.setDate(d.getDate() + i);
    const dow = d.getDay();
    const ds  = dateStr(d);
    if (dow === 1 || dow === 3 || dow === 5) {
      n++;
      schedule[ds] = { week: Math.ceil(n/3), type: n%2===1 ? 'A' : 'B' };
    } else {
      schedule[ds] = null;
    }
  }
}
buildSchedule();

function getProg(week) {
  for (const p of PROGRAM) if (p.weeks.includes(week)) return p;
  return PROGRAM[PROGRAM.length-1];
}
function getExercises(week, type) { const p = getProg(week); return type==='A' ? p.dayA : p.dayB; }
function getSets(week) { return getProg(week).sets; }

// ══════════════════════════════════════
// UTILS
// ══════════════════════════════════════
function dateStr(d) {
  return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');
}
function parseDate(s) { const [y,m,d]=s.split('-').map(Number); return new Date(y,m-1,d); }
function todayStr() { return dateStr(new Date()); }

function getStreak() {
  const todayDs = todayStr();
  const check   = new Date();
  if (schedule[todayDs] && !state.workouts[todayDs]?.done) check.setDate(check.getDate()-1);
  const start = parseDate(state.startDate);
  let streak = 0;
  for (let i=0; i<100; i++) {
    if (check < start) break;
    const ds = dateStr(check);
    if (ds in schedule) {
      if (schedule[ds] !== null) { // workout day
        if (state.workouts[ds]?.done) streak++;
        else break;
      }
      // rest day: skip
    }
    check.setDate(check.getDate()-1);
  }
  return streak;
}

function getTotalDone() { return Object.values(state.workouts).filter(w=>w.done).length; }

function getNextWorkout(fromDs) {
  const from = parseDate(fromDs);
  for (let i=1; i<=21; i++) {
    const d  = new Date(from); d.setDate(d.getDate()+i);
    const ds = dateStr(d);
    if (schedule[ds] && !state.workouts[ds]?.done) return { ds, sched:schedule[ds], d };
  }
  return null;
}

function nextLabel(fromDs) {
  const n = getNextWorkout(fromDs);
  if (!n) return 'Program complete!';
  const today0 = new Date(); today0.setHours(0,0,0,0);
  const diff   = Math.round((n.d - today0) / 86400000);
  const lbl    = diff===1 ? 'Tomorrow' : diff===0 ? 'Today' : DAYS[n.d.getDay()];
  return lbl + ' \u00b7 Day ' + n.sched.type;
}

function buildSections(exercises) {
  const s = {};
  exercises.forEach((e,i) => { if(!s[e.section]) s[e.section]=[]; s[e.section].push({...e,idx:i}); });
  return s;
}

function renderSections(sections, clickable, checked) {
  let html = '';
  Object.entries(sections).forEach(([sec, exs]) => {
    html += '<div class="section-label">'+sec+'</div>';
    exs.forEach(e => {
      const done   = checked ? !!checked[e.idx] : false;
      const cls    = (done?'done ':'') + (clickable?'':'preview');
      const onclick= clickable ? 'onclick="toggleEx('+e.idx+')"' : '';
      html += '<div class="ex-card '+cls+'" '+onclick+'>'
            + '<div class="ex-check"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>'
            + '<div class="ex-info"><div class="ex-title">'+e.name+'</div><div class="ex-detail">'+e.tip+'</div></div>'
            + '<div class="ex-badge">'+e.reps+'</div>'
            + '</div>';
    });
  });
  return html;
}

// ══════════════════════════════════════
// HOME
// ══════════════════════════════════════
function renderHome() {
  const now     = new Date();
  const todayDs = todayStr();
  const sched   = schedule[todayDs];
  const streak  = getStreak();
  const total   = getTotalDone();

  document.getElementById('home-date').textContent =
    DAYS[now.getDay()] + ', ' + now.getDate() + ' ' + MONTHS[now.getMonth()];

  let badge = '';
  if (sched)                  badge = 'WEEK '+sched.week+' \u00b7 DAY '+sched.type;
  else if (todayDs in schedule) badge = 'REST DAY';
  document.getElementById('week-badge').textContent = badge;

  // This week's workout dots (Mon-based)
  const mon = new Date(now);
  mon.setDate(now.getDate() - (now.getDay()===0 ? 6 : now.getDay()-1));
  const weekW = [];
  for (let i=0; i<7; i++) {
    const d = new Date(mon); d.setDate(mon.getDate()+i);
    const ds = dateStr(d);
    if (schedule[ds]) weekW.push({ds, isToday:ds===todayDs});
  }

  let html = '<div class="streak-row">'
    + '<div class="streak-box"><div class="streak-num">'+streak+'</div><div class="streak-lbl">&#x1F525; Streak</div></div>'
    + '<div class="streak-box"><div class="streak-num">'+total+'</div><div class="streak-lbl">&#x2713; Sessions</div></div>'
    + '</div>';

  if (weekW.length > 0) {
    const doneThisWeek = weekW.filter(w => state.workouts[w.ds]?.done).length;
    html += '<div class="card">'
      + '<div class="card-label">This Week ('+doneThisWeek+'/'+weekW.length+' done)</div>'
      + '<div class="week-dots">'
      + weekW.map(w => '<div class="week-dot '+(state.workouts[w.ds]?.done?'done':w.isToday?'today':'')+'"></div>').join('')
      + '</div></div>';
  }

  // Program complete banner
  const endDate = parseDate(state.startDate);
  endDate.setDate(endDate.getDate() + 7*7);
  if (now >= endDate && total > 0) {
    html += '<div class="completed-card">'
      + '<div style="font-size:40px;margin-bottom:10px;">&#x1F3C6;</div>'
      + '<div class="completed-title">7 Weeks Complete!</div>'
      + '<div class="completed-sub">'+total+' sessions. Reset in Settings to start again.</div>'
      + '</div>';
  }

  // Main card
  if (!sched) {
    html += '<div class="rest-card">'
      + '<div class="rest-emoji">&#x1F6CB;&#xFE0F;</div>'
      + '<div class="rest-title">Rest Day</div>'
      + '<div class="rest-sub">Recovery is part of the program.<br>Next: '+nextLabel(todayDs)+'</div>'
      + '</div>';
  } else if (state.workouts[todayDs]?.done) {
    html += '<div class="completed-card">'
      + '<div class="completed-title">&#x2713; Done for Today</div>'
      + '<div class="completed-sub">'+streak+' session streak &#x1F525;<br>Next: '+nextLabel(todayDs)+'</div>'
      + '</div>';
  } else {
    const exs  = getExercises(sched.week, sched.type);
    const sets = getSets(sched.week);
    html += '<div class="today-card">'
      + '<div class="today-header">'
      + '<div><div class="today-title">Day '+sched.type+' Workout</div>'
      + '<div class="today-meta">Week '+sched.week+' \u00b7 '+sets+' sets \u00b7 ~'+(sets===2?'20':'25')+' min</div></div>'
      + '<div style="font-size:32px;">'+(sched.type==='A'?'&#x1F4AA;':'&#x1F9B5;')+'</div>'
      + '</div><div class="today-body">'
      + exs.slice(0,4).map(e =>
          '<div class="exercise-preview"><span class="ex-name">'+e.name+'</span><span class="ex-reps">'+e.reps+'</span></div>'
        ).join('')
      + (exs.length>4 ? '<div style="font-size:12px;color:var(--text-dim);padding-top:8px;">+ '+(exs.length-4)+' more</div>' : '')
      + '</div></div>'
      + '<button class="start-btn" onclick="showPage(\'workout\')">Start Workout &#x2192;</button>';
  }

  document.getElementById('home-content').innerHTML = html;
}

// ══════════════════════════════════════
// WORKOUT
// ══════════════════════════════════════
let sessionChecked = []; // in-memory only, cleared after finish

function renderWorkout() {
  const todayDs = todayStr();
  const sched   = schedule[todayDs];
  document.getElementById('workout-page-title').textContent = "Today's Workout";

  if (!sched) {
    const next = getNextWorkout(todayDs);
    const today0 = new Date(); today0.setHours(0,0,0,0);
    const diff   = next ? Math.round((next.d - today0)/86400000) : 0;
    const previewLbl = next ? (diff===1 ? "Tomorrow's Workout" : DAYS[next.d.getDay()]+"'s Workout") : 'Next Workout';
    document.getElementById('workout-content').innerHTML =
      '<div class="rest-card">'
      + '<div class="rest-emoji">&#x1F6CB;&#xFE0F;</div>'
      + '<div class="rest-title">Rest Day</div>'
      + '<div class="rest-sub">Recovery is part of the program.<br>Next: '+nextLabel(todayDs)+'</div>'
      + '</div>'
      + '<button class="ghost-btn" onclick="renderWorkoutPreview()">Preview '+previewLbl+' &#x2192;</button>';
    return;
  }

  if (state.workouts[todayDs]?.done) {
    document.getElementById('workout-content').innerHTML =
      '<div class="completed-card" style="margin-top:8px;">'
      + '<div style="font-size:48px;margin-bottom:12px;">&#x2705;</div>'
      + '<div class="completed-title">Session Complete</div>'
      + '<div class="completed-sub">Next: '+nextLabel(todayDs)+'</div>'
      + '</div>';
    return;
  }

  const exs  = getExercises(sched.week, sched.type);
  const sets = getSets(sched.week);
  if (sessionChecked.length !== exs.length) sessionChecked = exs.map(()=>false);

  function build() {
    const done   = sessionChecked.filter(Boolean).length;
    const allDone = done === exs.length;
    const sections = buildSections(exs);
    let html = '<div class="workout-header-info">'
      + '<div><div class="wh-title">Day '+sched.type+' \u00b7 Week '+sched.week+'</div>'
      + '<div class="wh-sub">'+sets+' sets per exercise \u00b7 ~'+(sets===2?'20':'25')+' min</div></div>'
      + '<div class="wh-right"><div class="wh-progress">'+done+'/'+exs.length+'</div><div class="wh-done">exercises</div></div>'
      + '</div>';
    html += renderSections(sections, true, sessionChecked);
    if (sets>1) html += '<div style="font-size:12px;color:var(--text-dim);text-align:center;padding:4px 8px 8px;">Complete all '+sets+' sets before checking off &#x2713;</div>';
    html += '<button class="finish-btn'+(allDone?' ready':'')+'" id="finish-btn" '
          + (allDone ? 'onclick="finishWorkout()"' : 'disabled')+'>'
          + (allDone ? '&#x2713; Finish Session' : (exs.length-done)+' remaining')
          + '</button>';
    return html;
  }

  document.getElementById('workout-content').innerHTML = build();
}

function toggleEx(idx) {
  sessionChecked[idx] = !sessionChecked[idx];
  renderWorkout();
}

function finishWorkout() {
  const todayDs = todayStr();
  if (!schedule[todayDs]) return;
  state.workouts[todayDs] = { done:true };
  sessionChecked = [];
  saveState();

  const streak = getStreak();
  const total  = getTotalDone();
  const msgs   = [
    'Every session builds the habit.',
    streak+' in a row. Muscle memory is coming back.',
    'You showed up. That\'s what matters.',
    'Future you will thank present you.',
    total+' sessions done. You\'re building something real.',
    'Consistency beats intensity every time.',
  ];
  document.getElementById('cel-title').textContent = streak>=3 ? streak+' Streak! \uD83D\uDD25' : 'Session Done!';
  document.getElementById('cel-sub').textContent   = msgs[total % msgs.length];
  document.getElementById('celebration').classList.add('show');
}

function dismissCelebration() {
  document.getElementById('celebration').classList.remove('show');
  showPage('home');
}

function renderWorkoutPreview() {
  const next = getNextWorkout(todayStr());
  if (!next) {
    document.getElementById('workout-content').innerHTML =
      '<div class="rest-card"><div class="rest-emoji">&#x1F3C1;</div><div class="rest-title">Program Complete</div><div class="rest-sub">Reset in Settings to start a new cycle.</div></div>';
    return;
  }
  const {sched, d} = next;
  const exs  = getExercises(sched.week, sched.type);
  const sets = getSets(sched.week);
  const today0 = new Date(); today0.setHours(0,0,0,0);
  const diff   = Math.round((d - today0)/86400000);
  const dayLbl = diff===1 ? 'Tomorrow' : DAYS[d.getDay()];

  document.getElementById('workout-page-title').textContent = 'Preview';

  let html = '<div class="preview-banner">PREVIEW \u2014 '
    + dayLbl+', '+d.getDate()+' '+MONTHS_S[d.getMonth()]
    + ' \u00b7 Week '+sched.week+', Day '+sched.type
    + '</div>'
    + '<div class="workout-header-info">'
    + '<div><div class="wh-title">Day '+sched.type+' \u00b7 Week '+sched.week+'</div>'
    + '<div class="wh-sub">'+sets+' sets \u00b7 ~'+(sets===2?'20':'25')+' min</div></div>'
    + '<div class="wh-right"><div class="wh-progress">'+exs.length+'</div><div class="wh-done">exercises</div></div>'
    + '</div>'
    + renderSections(buildSections(exs), false, null)
    + '<button class="finish-btn" disabled>Preview Only \u2014 Not Logged</button>';

  document.getElementById('workout-content').innerHTML = html;
}

// ══════════════════════════════════════
// HISTORY
// ══════════════════════════════════════
function renderHistory() {
  const streak = getStreak();
  const total  = getTotalDone();
  document.getElementById('history-sub').textContent = total+' sessions \u00b7 '+streak+' streak \uD83D\uDD25';

  const now     = new Date();
  const year    = now.getFullYear();
  const month   = now.getMonth();
  const firstDow    = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1, 0).getDate();
  const offset      = firstDow===0 ? 6 : firstDow-1;

  let calHTML = '<div class="card"><div class="card-label">'+MONTHS[month]+' '+year+'</div>'
    + '<div class="calendar-grid">'
    + ['M','T','W','T','F','S','S'].map(n=>'<div class="cal-day-name">'+n+'</div>').join('')
    + Array(offset).fill('<div class="cal-day empty"></div>').join('');

  for (let d=1; d<=daysInMonth; d++) {
    const ds      = year+'-'+String(month+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
    const isToday = ds===todayStr();
    const date    = new Date(year, month, d);
    const isPast  = date<=now;
    const sched   = schedule[ds];
    let cls = '';
    if      (!isPast)                       cls = 'future';
    else if (!sched)                        cls = 'rest-day';
    else if (state.workouts[ds]?.done)      cls = 'workout-done';
    else if (isPast && !isToday)            cls = 'workout-missed';
    if (isToday) cls += ' today';
    calHTML += '<div class="cal-day '+cls.trim()+'">'+d+'</div>';
  }

  calHTML += '</div><div class="legend-row">'
    + '<div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div>Done</div>'
    + '<div class="legend-item"><div class="legend-dot" style="background:var(--red-dim);outline:1px solid var(--red)"></div>Missed</div>'
    + '<div class="legend-item"><div class="legend-dot" style="background:var(--bg3)"></div>Rest</div>'
    + '</div></div>';

  const doneDates = Object.keys(state.workouts).filter(ds=>state.workouts[ds].done).sort().reverse();
  let listHTML = '';
  if (doneDates.length===0) {
    listHTML = '<div class="card" style="text-align:center;color:var(--text-dim);font-size:14px;padding:32px 16px;">No sessions yet.<br>Start your first workout!</div>';
  } else {
    listHTML = '<div class="card"><div class="card-label">Sessions ('+doneDates.length+')</div>';
    doneDates.slice(0,30).forEach(ds => {
      const d     = parseDate(ds);
      const sched = schedule[ds];
      listHTML += '<div class="history-item">'
        + '<div><div class="hi-date">'+DAYS[d.getDay()]+', '+d.getDate()+' '+MONTHS_S[d.getMonth()]+'</div>'
        + '<div class="hi-type">'+(sched?'Day '+sched.type+' \u00b7 Week '+sched.week:'\u2014')+'</div></div>'
        + '<div class="hi-badge done">\u2713 Done</div>'
        + '</div>';
    });
    listHTML += '</div>';
  }

  document.getElementById('history-content').innerHTML = calHTML + listHTML;
}

// ══════════════════════════════════════
// SETTINGS
// ══════════════════════════════════════
function renderSettings() {
  const total = getTotalDone();
  document.getElementById('settings-content').innerHTML = `
    <div class="card">
      <div class="card-label">Program</div>
      <div class="setting-row">
        <div><div class="setting-label">Start Date</div><div class="setting-sub">First Monday of your program</div></div>
        <input type="date" class="setting-input" value="${state.startDate}" onchange="updateStart(this.value)"/>
      </div>
      <div class="setting-row" style="border:none;padding-top:6px;">
        <div style="font-size:13px;color:var(--text-dim);">Sessions completed</div>
        <div style="font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:700;color:var(--accent);">${total}</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">Program Overview</div>
      <div style="font-size:13px;color:var(--text-dim);">
        <div style="padding:8px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;"><span>Week 1&#x2013;2</span><span style="color:var(--text);">Habit building &#x00b7; 2 sets</span></div>
        <div style="padding:8px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;"><span>Week 3&#x2013;4</span><span style="color:var(--text);">Building up &#x00b7; 3 sets</span></div>
        <div style="padding:8px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;"><span>Week 5&#x2013;6</span><span style="color:var(--text);">Challenging &#x00b7; 3 sets</span></div>
        <div style="padding:8px 0;display:flex;justify-content:space-between;"><span>Week 7</span><span style="color:var(--accent);">Peak &#x00b7; 3 sets</span></div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">Your Notes</div>
      <div style="font-size:13px;color:var(--text-dim);line-height:2.1;">
        &#x1F9B4; All exercises bilateral &#x2014; scoliosis safe<br>
        &#x1F3E5; Core + neck work physio-approved<br>
        &#x1F35A; Eat 6&#x2013;7pm &#x2192; workout ~9pm &#x2192; shower<br>
        &#x1F4AA; At 50kg you'll respond fast &#x2014; trust it<br>
        &#x26A1; Muscle memory kicks in around Week 3
      </div>
    </div>
    <div class="card">
      <div class="card-label">Data</div>
      <div class="setting-row">
        <div><div class="setting-label">Reset All Data</div><div class="setting-sub">Clears history, keeps start date</div></div>
        <button class="danger-btn" onclick="resetData()">Reset</button>
      </div>
    </div>
    <div style="text-align:center;font-size:11px;color:var(--text-dim);padding:16px 0 8px;line-height:2;opacity:0.5;">
      GRIND &#x00b7; 7-Week Home Program<br>
      Safari &#x2192; Share &#x2192; Add to Home Screen
    </div>`;
}

function updateStart(val) {
  if (!val) return;
  state.startDate = val;
  buildSchedule();
  saveState();
}

function resetData() {
  if (!confirm('Reset all workout history? This cannot be undone.')) return;
  state.workouts = {};
  sessionChecked = [];
  saveState();
  showPage('home');
}

// ══════════════════════════════════════
// NAVIGATION
// ══════════════════════════════════════
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  document.getElementById('nav-'+name).classList.add('active');
  if (name==='home')     renderHome();
  if (name==='workout')  renderWorkout();
  if (name==='history')  renderHistory();
  if (name==='settings') renderSettings();
  window.scrollTo(0,0);
}

// ══════════════════════════════════════
// INIT
// ══════════════════════════════════════
renderHome();
</script>
</body>
</html>
